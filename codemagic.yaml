workflows:
  graph-app-android:
    name: Build Graph App APK
    max_build_duration: 120
    instance_type: mac_mini_m1
    
    scripts:
      - name: Set up Flutter
        script: |
          flutter doctor -v
          
      - name: Create proper Flutter project
        script: |
          flutter create --org com.example --platforms android graph_project
          
      - name: Replace with OUR graph app code
        script: |
          cd graph_project
          cat > lib/main.dart << 'EOF'
          import 'package:flutter/material.dart';
          import 'dart:math';

          void main() {
            runApp(const GraphApp());
          }

          class GraphApp extends StatelessWidget {
            const GraphApp({super.key});

            @override
            Widget build(BuildContext context) {
              return MaterialApp(
                title: '–ü–æ—Å—Ç—Ä–æ–∏—Ç–µ–ª—å –≥—Ä–∞—Ñ–∏–∫–æ–≤',
                theme: ThemeData(
                  primarySwatch: Colors.blue,
                  useMaterial3: true,
                ),
                home: const GraphScreen(),
              );
            }
          }

          class GraphScreen extends StatefulWidget {
            const GraphScreen({super.key});

            @override
            State<GraphScreen> createState() => _GraphScreenState();
          }

          class _GraphScreenState extends State<GraphScreen> {
            final TextEditingController _functionController = TextEditingController(text: 'x*x');
            final List<Map<String, dynamic>> _functions = [];

            @override
            Widget build(BuildContext context) {
              return Scaffold(
                appBar: AppBar(title: const Text('üìà –ü–æ—Å—Ç—Ä–æ–∏—Ç–µ–ª—å –≥—Ä–∞—Ñ–∏–∫–æ–≤')),
                body: Padding(
                  padding: const EdgeInsets.all(16.0),
                  child: Column(
                    children: [
                      TextField(
                        controller: _functionController,
                        decoration: const InputDecoration(
                          labelText: '–§—É–Ω–∫—Ü–∏—è',
                          hintText: '–ù–∞–ø—Ä–∏–º–µ—Ä: x*x –∏–ª–∏ sin(x)',
                          border: OutlineInputBorder(),
                        ),
                      ),
                      const SizedBox(height: 20),
                      ElevatedButton(
                        onPressed: () {
                          setState(() {
                            _functions.add({
                              'expression': _functionController.text,
                              'color': Colors.primaries[_functions.length % Colors.primaries.length],
                            });
                          });
                        },
                        child: const Text('–î–æ–±–∞–≤–∏—Ç—å –≥—Ä–∞—Ñ–∏–∫'),
                      ),
                      const SizedBox(height: 20),
                      if (_functions.isNotEmpty) ...[
                        const Text(
                          '–î–æ–±–∞–≤–ª–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:',
                          style: TextStyle(fontSize: 18, fontWeight: FontWeight.bold),
                        ),
                        const SizedBox(height: 10),
                        Expanded(
                          child: ListView.builder(
                            itemCount: _functions.length,
                            itemBuilder: (context, index) {
                              final func = _functions[index];
                              return ListTile(
                                leading: Container(
                                  width: 20,
                                  height: 20,
                                  decoration: BoxDecoration(
                                    color: func['color'],
                                    shape: BoxShape.circle,
                                  ),
                                ),
                                title: Text(
                                  func['expression'],
                                  style: const TextStyle(fontFamily: 'monospace'),
                                ),
                              );
                            },
                          ),
                        ),
                      ],
                    ],
                  ),
                ),
              );
            }
          }
          EOF

      - name: Build Android APK
        script: |
          cd graph_project
          flutter build apk --release
          
    artifacts:
      - graph_project/build/app/outputs/flutter-apk/**/*.apk